<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<script src='./dist/index.global.js'></script>
<script>

document.addEventListener('DOMContentLoaded', 
async function() 
{
	// DB에서 가져온 값을 담을 변수 선언 eventList
	let eventList = 
	[
		{
			title:"title",
			start:"2025-08-07"
		}
	];
	//ajax 실행
	let result = await fetch('searchCal.do');
	let data = await result.json();
	eventList = data;
	var calendarEl = document.getElementById('calendar');
	var calendar = 
	new FullCalendar.Calendar(calendarEl, 
		{
		    headerToolbar: 
		    {
				left: 'prev,next today',
				center: 'title',
				right: 'dayGridMonth,timeGridWeek,timeGridDay'
			},
			initialDate: '2025-08-07',
			navLinks: true, // can click day/week names to navigate views
			selectable: true,
			selectMirror: true,
			select: async function(arg) 
			{
    	  		//console.log(arg);// title, startStr, endStr 필요
        		var title = prompt('일정을 등록하세요:');
		        if (title) 
		        {
		        	let resolve = await fetch('registerCal.do?title=' + title + '&start=' + arg.startStr + '&end=' +arg.endStr);
		        	let result = await resolve.json();
	        		if (result.retCode =="OK")
	        		{
	        			const newEvent = result.retVal;
				        calendar.addEvent(
				        {
				        	title: title,
				            start: arg.start,
				            end: arg.end,
				            allDay: arg.allDay,
				            eventNo: newEvent.eventNo
				        })
	        		}
	        		else if (result.retCode =="NG")
	        		{
	        			alert('예외발생!');
		        		console.error("예외발생");		
	        		}
	        		else
        			{
        				console.error("알수없는 예외");
        			}
		
		        }
				calendar.unselect()
			},
      		eventClick: async function(arg) 
      		{
        		console.log(arg);
		        if (confirm('해당 일정을 삭제하시겠습니까?')) 
		        {
		        	let resolve = await fetch("removeCal.do?event_no="+arg.event.extendedProps.eventNo);
		        	let result = await resolve.json();
		        	
	        		if(result.retCode == 'OK')
	        		{
			        	arg.event.remove()
	        		}
	        		else if (result.retCode =="NG")
	        		{
		        		console.error("예외발생");		
	        		}
	        		else
	       			{
	       				console.error("알수없는 예외");
	       			}
		        }
			},
			editable: true,
			dayMaxEvents: true, // allow "more" link when too many events
			events: eventList
		});
	calendar.render();
});

</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>

  <div id='calendar'></div>

</body>
</html>
